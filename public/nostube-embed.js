/* Nostube Embed Player v0.1.0 | https://nostube.com */
(()=>{var xr=Object.defineProperty;var Ls=(t,e,n)=>e in t?xr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _s=(t,e)=>{for(var n in e)xr(t,n,{get:e[n],enumerable:!0})};var Yt=(t,e,n)=>Ls(t,typeof e!="symbol"?e+"":e,n);function vr(){let t=new URLSearchParams(window.location.search);return{videoId:t.get("v")||"",autoplay:t.get("autoplay")==="1",muted:t.get("muted")==="1",loop:t.get("loop")==="1",startTime:parseInt(t.get("t")||"0",10),controls:t.get("controls")!=="0",showTitle:t.get("title")!=="0",showBranding:t.get("branding")!=="0",preferredQuality:t.get("quality")||"auto",customRelays:t.get("relays")?t.get("relays").split(",").map(e=>e.trim()):[],accentColor:t.get("color")||"8b5cf6"}}function Er(t){return t.videoId?!t.videoId.startsWith("nevent1")&&!t.videoId.startsWith("naddr1")&&!t.videoId.startsWith("note1")?{valid:!1,error:"Invalid video ID format. Must be nevent1..., naddr1..., or note1..."}:{valid:!0}:{valid:!1,error:"Missing required parameter: v (video ID)"}}function Br(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function nn(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Tr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Br(t.outputLen),Br(t.blockLen)}function Xt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ar(t,e){nn(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var ge=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Sr=t=>t instanceof Uint8Array;var ye=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ft=(t,e)=>t<<32-e|t>>>e,ks=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ks)throw new Error("Non little-endian hardware is not supported");function Is(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function ae(t){if(typeof t=="string"&&(t=Is(t)),!Sr(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Lr(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!Sr(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var Qt=class{clone(){return this._cloneInto()}},al={}.toString;function _r(t){let e=r=>t().update(ae(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function we(t=32){if(ge&&typeof ge.getRandomValues=="function")return ge.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Us(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var be=class extends Qt{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ye(this.buffer)}update(e){Xt(this);let{view:n,buffer:r,blockLen:o}=this;e=ae(e);let s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=ye(e);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Xt(this),Ar(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;Us(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=ye(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,l[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return e.length=o,e.pos=c,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var Rs=(t,e,n)=>t&e^~t&n,Os=(t,e,n)=>t&e^t&n^e&n,Ns=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),kt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),It=new Uint32Array(64),rn=class extends be{constructor(){super(64,32,8,!1),this.A=kt[0]|0,this.B=kt[1]|0,this.C=kt[2]|0,this.D=kt[3]|0,this.E=kt[4]|0,this.F=kt[5]|0,this.G=kt[6]|0,this.H=kt[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[e,n,r,o,s,i,c,a]}set(e,n,r,o,s,i,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)It[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let g=It[u-15],y=It[u-2],p=ft(g,7)^ft(g,18)^g>>>3,d=ft(y,17)^ft(y,19)^y>>>10;It[u]=d+It[u-7]+p+It[u-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:l}=this;for(let u=0;u<64;u++){let g=ft(c,6)^ft(c,11)^ft(c,25),y=l+g+Rs(c,a,f)+Ns[u]+It[u]|0,d=(ft(r,2)^ft(r,13)^ft(r,22))+Os(r,o,s)|0;l=f,f=a,a=c,c=i+y|0,i=s,s=o,o=r,r=y+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(r,o,s,i,c,a,f,l)}roundClean(){It.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var me=_r(()=>new rn);var an={};_s(an,{bitGet:()=>Ws,bitLen:()=>Ms,bitMask:()=>fe,bitSet:()=>Vs,bytesToHex:()=>Vt,bytesToNumberBE:()=>J,bytesToNumberLE:()=>Ee,concatBytes:()=>vt,createHmacDrbg:()=>cn,ensureBytes:()=>z,equalBytes:()=>$s,hexToBytes:()=>Dt,hexToNumber:()=>sn,numberToBytesBE:()=>lt,numberToBytesLE:()=>Be,numberToHexUnpadded:()=>Ur,numberToVarBytesBE:()=>Ps,utf8ToBytes:()=>qs,validateObject:()=>Ut});var Ir=BigInt(0),xe=BigInt(1),Cs=BigInt(2),ve=t=>t instanceof Uint8Array,Hs=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Vt(t){if(!ve(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Hs[t[n]];return e}function Ur(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function sn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Dt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function J(t){return sn(Vt(t))}function Ee(t){if(!ve(t))throw new Error("Uint8Array expected");return sn(Vt(Uint8Array.from(t).reverse()))}function lt(t,e){return Dt(t.toString(16).padStart(e*2,"0"))}function Be(t,e){return lt(t,e).reverse()}function Ps(t){return Dt(Ur(t))}function z(t,e,n){let r;if(typeof e=="string")try{r=Dt(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(ve(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function vt(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!ve(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function $s(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function qs(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ms(t){let e;for(e=0;t>Ir;t>>=xe,e+=1);return e}function Ws(t,e){return t>>BigInt(e)&xe}var Vs=(t,e,n)=>t|(n?xe:Ir)<<BigInt(e),fe=t=>(Cs<<BigInt(t-1))-xe,on=t=>new Uint8Array(t),kr=t=>Uint8Array.from(t);function cn(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=on(t),o=on(t),s=0,i=()=>{r.fill(1),o.fill(0),s=0},c=(...u)=>n(o,r,...u),a=(u=on())=>{o=c(kr([0]),u),r=c(),u.length!==0&&(o=c(kr([1]),u),r=c())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0,g=[];for(;u<e;){r=c();let y=r.slice();g.push(y),u+=r.length}return vt(...g)};return(u,g)=>{i(),a(u);let y;for(;!(y=g(f()));)a();return i(),y}}var Ds={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ut(t,e,n={}){let r=(o,s,i)=>{let c=Ds[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);let a=t[o];if(!(i&&a===void 0)&&!c(a,t))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${s}`)};for(let[o,s]of Object.entries(e))r(o,s,!1);for(let[o,s]of Object.entries(n))r(o,s,!0);return t}var Z=BigInt(0),D=BigInt(1),jt=BigInt(2),js=BigInt(3),fn=BigInt(4),Rr=BigInt(5),Or=BigInt(8),zs=BigInt(9),Ks=BigInt(16);function K(t,e){let n=t%e;return n>=Z?n:e+n}function Zs(t,e,n){if(n<=Z||e<Z)throw new Error("Expected power/modulo > 0");if(n===D)return Z;let r=D;for(;e>Z;)e&D&&(r=r*t%n),t=t*t%n,e>>=D;return r}function nt(t,e,n){let r=t;for(;e-- >Z;)r*=r,r%=n;return r}function Te(t,e){if(t===Z||e<=Z)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=K(t,e),r=e,o=Z,s=D,i=D,c=Z;for(;n!==Z;){let f=r/n,l=r%n,u=o-i*f,g=s-c*f;r=n,n=l,o=i,s=c,i=u,c=g}if(r!==D)throw new Error("invert: does not exist");return K(o,e)}function Gs(t){let e=(t-D)/jt,n,r,o;for(n=t-D,r=0;n%jt===Z;n/=jt,r++);for(o=jt;o<t&&Zs(o,e,t)!==t-D;o++);if(r===1){let i=(t+D)/fn;return function(a,f){let l=a.pow(f,i);if(!a.eql(a.sqr(l),f))throw new Error("Cannot find square root");return l}}let s=(n+D)/jt;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,l=c.pow(c.mul(c.ONE,o),n),u=c.pow(a,s),g=c.pow(a,n);for(;!c.eql(g,c.ONE);){if(c.eql(g,c.ZERO))return c.ZERO;let y=1;for(let d=c.sqr(g);y<f&&!c.eql(d,c.ONE);y++)d=c.sqr(d);let p=c.pow(l,D<<BigInt(f-y-1));l=c.sqr(p),u=c.mul(u,p),g=c.mul(g,l),f=y}return u}}function Js(t){if(t%fn===js){let e=(t+D)/fn;return function(r,o){let s=r.pow(o,e);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(t%Or===Rr){let e=(t-Rr)/Or;return function(r,o){let s=r.mul(o,jt),i=r.pow(s,e),c=r.mul(o,i),a=r.mul(r.mul(c,jt),i),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return t%Ks,Gs(t)}var Ys=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ln(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Ys.reduce((r,o)=>(r[o]="function",r),e);return Ut(t,n)}function Xs(t,e,n){if(n<Z)throw new Error("Expected power > 0");if(n===Z)return t.ONE;if(n===D)return e;let r=t.ONE,o=e;for(;n>Z;)n&D&&(r=t.mul(r,o)),o=t.sqr(o),n>>=D;return r}function Qs(t,e){let n=new Array(e.length),r=e.reduce((s,i,c)=>t.is0(i)?s:(n[c]=s,t.mul(s,i)),t.ONE),o=t.inv(r);return e.reduceRight((s,i,c)=>t.is0(i)?s:(n[c]=t.mul(s,n[c]),t.mul(s,i)),o),n}function un(t,e){let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Nr(t,e,n=!1,r={}){if(t<=Z)throw new Error(`Expected Field ORDER > 0, got ${t}`);let{nBitLength:o,nByteLength:s}=un(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=Js(t),c=Object.freeze({ORDER:t,BITS:o,BYTES:s,MASK:fe(o),ZERO:Z,ONE:D,create:a=>K(a,t),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return Z<=a&&a<t},is0:a=>a===Z,isOdd:a=>(a&D)===D,neg:a=>K(-a,t),eql:(a,f)=>a===f,sqr:a=>K(a*a,t),add:(a,f)=>K(a+f,t),sub:(a,f)=>K(a-f,t),mul:(a,f)=>K(a*f,t),pow:(a,f)=>Xs(c,a,f),div:(a,f)=>K(a*Te(f,t),t),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>Te(a,t),sqrt:r.sqrt||(a=>i(c,a)),invertBatch:a=>Qs(c,a),cmov:(a,f,l)=>l?f:a,toBytes:a=>n?Be(a,s):lt(a,s),fromBytes:a=>{if(a.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${a.length}`);return n?Ee(a):J(a)}});return Object.freeze(c)}function Cr(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function dn(t){let e=Cr(t);return e+Math.ceil(e/2)}function Hr(t,e,n=!1){let r=t.length,o=Cr(e),s=dn(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);let i=n?J(t):Ee(t),c=K(i,e-D)+D;return n?Be(c,o):lt(c,o)}var ti=BigInt(0),hn=BigInt(1);function Pr(t,e){let n=(o,s)=>{let i=s.negate();return o?i:s},r=o=>{let s=Math.ceil(e/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=t.ZERO,c=o;for(;s>ti;)s&hn&&(i=i.add(c)),c=c.double(),s>>=hn;return i},precomputeWindow(o,s){let{windows:i,windowSize:c}=r(s),a=[],f=o,l=f;for(let u=0;u<i;u++){l=f,a.push(l);for(let g=1;g<c;g++)l=l.add(f),a.push(l);f=l.double()}return a},wNAF(o,s,i){let{windows:c,windowSize:a}=r(o),f=t.ZERO,l=t.BASE,u=BigInt(2**o-1),g=2**o,y=BigInt(o);for(let p=0;p<c;p++){let d=p*a,h=Number(i&u);i>>=y,h>a&&(h-=g,i+=hn);let w=d,b=d+Math.abs(h)-1,v=p%2!==0,T=h<0;h===0?l=l.add(n(v,s[w])):f=f.add(n(T,s[b]))}return{p:f,f:l}},wNAFCached(o,s,i,c){let a=o._WINDOW_SIZE||1,f=s.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&s.set(o,c(f))),this.wNAF(a,f,i)}}}function pn(t){return ln(t.Fp),Ut(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...un(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function ei(t){let e=pn(t);Ut(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}var{bytesToNumberBE:ni,hexToBytes:ri}=an,zt={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:e}=zt;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");let n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:ni(r),l:t.subarray(n+2)}},toSig(t){let{Err:e}=zt,n=typeof t=="string"?ri(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");let{d:o,l:s}=zt._parseInt(n.subarray(2)),{d:i,l:c}=zt._parseInt(s);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(t){let e=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{let l=f.toString(16);return l.length&1?`0${l}`:l},r=e(n(t.s)),o=e(n(t.r)),s=r.length/2,i=o.length/2,c=n(s),a=n(i);return`30${n(i+s+4)}02${a}${o}02${c}${r}`}},Et=BigInt(0),st=BigInt(1),Bl=BigInt(2),$r=BigInt(3),Tl=BigInt(4);function oi(t){let e=ei(t),{Fp:n}=e,r=e.toBytes||((p,d,h)=>{let w=d.toAffine();return vt(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),o=e.fromBytes||(p=>{let d=p.subarray(1),h=n.fromBytes(d.subarray(0,n.BYTES)),w=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:h,y:w}});function s(p){let{a:d,b:h}=e,w=n.sqr(p),b=n.mul(w,p);return n.add(n.add(b,n.mul(p,d)),h)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function i(p){return typeof p=="bigint"&&Et<p&&p<e.n}function c(p){if(!i(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(p){let{allowedPrivateKeyLengths:d,nByteLength:h,wrapPrivateKey:w,n:b}=e;if(d&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Vt(p)),typeof p!="string"||!d.includes(p.length))throw new Error("Invalid key");p=p.padStart(h*2,"0")}let v;try{v=typeof p=="bigint"?p:J(z("private key",p,h))}catch{throw new Error(`private key must be ${h} bytes, hex or bigint, not ${typeof p}`)}return w&&(v=K(v,b)),c(v),v}let f=new Map;function l(p){if(!(p instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(d,h,w){if(this.px=d,this.py=h,this.pz=w,d==null||!n.isValid(d))throw new Error("x required");if(h==null||!n.isValid(h))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(d){let{x:h,y:w}=d||{};if(!d||!n.isValid(h)||!n.isValid(w))throw new Error("invalid affine point");if(d instanceof u)throw new Error("projective point not allowed");let b=v=>n.eql(v,n.ZERO);return b(h)&&b(w)?u.ZERO:new u(h,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){let h=n.invertBatch(d.map(w=>w.pz));return d.map((w,b)=>w.toAffine(h[b])).map(u.fromAffine)}static fromHex(d){let h=u.fromAffine(o(z("pointHex",d)));return h.assertValidity(),h}static fromPrivateKey(d){return u.BASE.multiply(a(d))}_setWindowSize(d){this._WINDOW_SIZE=d,f.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:d,y:h}=this.toAffine();if(!n.isValid(d)||!n.isValid(h))throw new Error("bad point: x or y not FE");let w=n.sqr(h),b=s(d);if(!n.eql(w,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){l(d);let{px:h,py:w,pz:b}=this,{px:v,py:T,pz:k}=d,B=n.eql(n.mul(h,k),n.mul(v,b)),A=n.eql(n.mul(w,k),n.mul(T,b));return B&&A}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){let{a:d,b:h}=e,w=n.mul(h,$r),{px:b,py:v,pz:T}=this,k=n.ZERO,B=n.ZERO,A=n.ZERO,L=n.mul(b,b),O=n.mul(v,v),U=n.mul(T,T),I=n.mul(b,v);return I=n.add(I,I),A=n.mul(b,T),A=n.add(A,A),k=n.mul(d,A),B=n.mul(w,U),B=n.add(k,B),k=n.sub(O,B),B=n.add(O,B),B=n.mul(k,B),k=n.mul(I,k),A=n.mul(w,A),U=n.mul(d,U),I=n.sub(L,U),I=n.mul(d,I),I=n.add(I,A),A=n.add(L,L),L=n.add(A,L),L=n.add(L,U),L=n.mul(L,I),B=n.add(B,L),U=n.mul(v,T),U=n.add(U,U),L=n.mul(U,I),k=n.sub(k,L),A=n.mul(U,O),A=n.add(A,A),A=n.add(A,A),new u(k,B,A)}add(d){l(d);let{px:h,py:w,pz:b}=this,{px:v,py:T,pz:k}=d,B=n.ZERO,A=n.ZERO,L=n.ZERO,O=e.a,U=n.mul(e.b,$r),I=n.mul(h,v),P=n.mul(w,T),$=n.mul(b,k),W=n.add(h,w),m=n.add(v,T);W=n.mul(W,m),m=n.add(I,P),W=n.sub(W,m),m=n.add(h,b);let x=n.add(v,k);return m=n.mul(m,x),x=n.add(I,$),m=n.sub(m,x),x=n.add(w,b),B=n.add(T,k),x=n.mul(x,B),B=n.add(P,$),x=n.sub(x,B),L=n.mul(O,m),B=n.mul(U,$),L=n.add(B,L),B=n.sub(P,L),L=n.add(P,L),A=n.mul(B,L),P=n.add(I,I),P=n.add(P,I),$=n.mul(O,$),m=n.mul(U,m),P=n.add(P,$),$=n.sub(I,$),$=n.mul(O,$),m=n.add(m,$),I=n.mul(P,m),A=n.add(A,I),I=n.mul(x,m),B=n.mul(W,B),B=n.sub(B,I),I=n.mul(W,P),L=n.mul(x,L),L=n.add(L,I),new u(B,A,L)}subtract(d){return this.add(d.negate())}is0(){return this.equals(u.ZERO)}wNAF(d){return y.wNAFCached(this,f,d,h=>{let w=n.invertBatch(h.map(b=>b.pz));return h.map((b,v)=>b.toAffine(w[v])).map(u.fromAffine)})}multiplyUnsafe(d){let h=u.ZERO;if(d===Et)return h;if(c(d),d===st)return this;let{endo:w}=e;if(!w)return y.unsafeLadder(this,d);let{k1neg:b,k1:v,k2neg:T,k2:k}=w.splitScalar(d),B=h,A=h,L=this;for(;v>Et||k>Et;)v&st&&(B=B.add(L)),k&st&&(A=A.add(L)),L=L.double(),v>>=st,k>>=st;return b&&(B=B.negate()),T&&(A=A.negate()),A=new u(n.mul(A.px,w.beta),A.py,A.pz),B.add(A)}multiply(d){c(d);let h=d,w,b,{endo:v}=e;if(v){let{k1neg:T,k1:k,k2neg:B,k2:A}=v.splitScalar(h),{p:L,f:O}=this.wNAF(k),{p:U,f:I}=this.wNAF(A);L=y.constTimeNegate(T,L),U=y.constTimeNegate(B,U),U=new u(n.mul(U.px,v.beta),U.py,U.pz),w=L.add(U),b=O.add(I)}else{let{p:T,f:k}=this.wNAF(h);w=T,b=k}return u.normalizeZ([w,b])[0]}multiplyAndAddUnsafe(d,h,w){let b=u.BASE,v=(k,B)=>B===Et||B===st||!k.equals(b)?k.multiplyUnsafe(B):k.multiply(B),T=v(this,h).add(v(d,w));return T.is0()?void 0:T}toAffine(d){let{px:h,py:w,pz:b}=this,v=this.is0();d==null&&(d=v?n.ONE:n.inv(b));let T=n.mul(h,d),k=n.mul(w,d),B=n.mul(b,d);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:T,y:k}}isTorsionFree(){let{h:d,isTorsionFree:h}=e;if(d===st)return!0;if(h)return h(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:d,clearCofactor:h}=e;return d===st?this:h?h(u,this):this.multiplyUnsafe(e.h)}toRawBytes(d=!0){return this.assertValidity(),r(u,this,d)}toHex(d=!0){return Vt(this.toRawBytes(d))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);let g=e.nBitLength,y=Pr(u,e.endo?Math.ceil(g/2):g);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:i}}function si(t){let e=pn(t);return Ut(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function qr(t){let e=si(t),{Fp:n,n:r}=e,o=n.BYTES+1,s=2*n.BYTES+1;function i(m){return Et<m&&m<n.ORDER}function c(m){return K(m,r)}function a(m){return Te(m,r)}let{ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:g}=oi({...e,toBytes(m,x,_){let R=x.toAffine(),E=n.toBytes(R.x),N=vt;return _?N(Uint8Array.from([x.hasEvenY()?2:3]),E):N(Uint8Array.from([4]),E,n.toBytes(R.y))},fromBytes(m){let x=m.length,_=m[0],R=m.subarray(1);if(x===o&&(_===2||_===3)){let E=J(R);if(!i(E))throw new Error("Point is not on curve");let N=u(E),M=n.sqrt(N),q=(M&st)===st;return(_&1)===1!==q&&(M=n.neg(M)),{x:E,y:M}}else if(x===s&&_===4){let E=n.fromBytes(R.subarray(0,n.BYTES)),N=n.fromBytes(R.subarray(n.BYTES,2*n.BYTES));return{x:E,y:N}}else throw new Error(`Point of length ${x} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),y=m=>Vt(lt(m,e.nByteLength));function p(m){let x=r>>st;return m>x}function d(m){return p(m)?c(-m):m}let h=(m,x,_)=>J(m.slice(x,_));class w{constructor(x,_,R){this.r=x,this.s=_,this.recovery=R,this.assertValidity()}static fromCompact(x){let _=e.nByteLength;return x=z("compactSignature",x,_*2),new w(h(x,0,_),h(x,_,2*_))}static fromDER(x){let{r:_,s:R}=zt.toSig(z("DER",x));return new w(_,R)}assertValidity(){if(!g(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!g(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(x){return new w(this.r,this.s,x)}recoverPublicKey(x){let{r:_,s:R,recovery:E}=this,N=A(z("msgHash",x));if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");let M=E===2||E===3?_+e.n:_;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let q=(E&1)===0?"02":"03",G=f.fromHex(q+y(M)),X=a(M),et=c(-N*X),ot=c(R*X),Q=f.BASE.multiplyAndAddUnsafe(G,et,ot);if(!Q)throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Dt(this.toDERHex())}toDERHex(){return zt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Dt(this.toCompactHex())}toCompactHex(){return y(this.r)+y(this.s)}}let b={isValidPrivateKey(m){try{return l(m),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let m=dn(e.n);return Hr(e.randomBytes(m),e.n)},precompute(m=8,x=f.BASE){return x._setWindowSize(m),x.multiply(BigInt(3)),x}};function v(m,x=!0){return f.fromPrivateKey(m).toRawBytes(x)}function T(m){let x=m instanceof Uint8Array,_=typeof m=="string",R=(x||_)&&m.length;return x?R===o||R===s:_?R===2*o||R===2*s:m instanceof f}function k(m,x,_=!0){if(T(m))throw new Error("first arg must be private key");if(!T(x))throw new Error("second arg must be public key");return f.fromHex(x).multiply(l(m)).toRawBytes(_)}let B=e.bits2int||function(m){let x=J(m),_=m.length*8-e.nBitLength;return _>0?x>>BigInt(_):x},A=e.bits2int_modN||function(m){return c(B(m))},L=fe(e.nBitLength);function O(m){if(typeof m!="bigint")throw new Error("bigint expected");if(!(Et<=m&&m<L))throw new Error(`bigint expected < 2^${e.nBitLength}`);return lt(m,e.nByteLength)}function U(m,x,_=I){if(["recovered","canonical"].some(tt=>tt in _))throw new Error("sign() legacy options not supported");let{hash:R,randomBytes:E}=e,{lowS:N,prehash:M,extraEntropy:q}=_;N==null&&(N=!0),m=z("msgHash",m),M&&(m=z("prehashed msgHash",R(m)));let G=A(m),X=l(x),et=[O(X),O(G)];if(q!=null){let tt=q===!0?E(n.BYTES):q;et.push(z("extraEntropy",tt))}let ot=vt(...et),Q=G;function ht(tt){let Gt=B(tt);if(!g(Gt))return;let wr=a(Gt),pt=f.BASE.multiply(Gt).toAffine(),Jt=c(pt.x);if(Jt===Et)return;let pe=c(wr*c(Q+Jt*X));if(pe===Et)return;let br=(pt.x===Jt?0:2)|Number(pt.y&st),mr=pe;return N&&p(pe)&&(mr=d(pe),br^=1),new w(Jt,mr,br)}return{seed:ot,k2sig:ht}}let I={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function $(m,x,_=I){let{seed:R,k2sig:E}=U(m,x,_),N=e;return cn(N.hash.outputLen,N.nByteLength,N.hmac)(R,E)}f.BASE._setWindowSize(8);function W(m,x,_,R=P){let E=m;if(x=z("msgHash",x),_=z("publicKey",_),"strict"in R)throw new Error("options.strict was renamed to lowS");let{lowS:N,prehash:M}=R,q,G;try{if(typeof E=="string"||E instanceof Uint8Array)try{q=w.fromDER(E)}catch(pt){if(!(pt instanceof zt.Err))throw pt;q=w.fromCompact(E)}else if(typeof E=="object"&&typeof E.r=="bigint"&&typeof E.s=="bigint"){let{r:pt,s:Jt}=E;q=new w(pt,Jt)}else throw new Error("PARSE");G=f.fromHex(_)}catch(pt){if(pt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&q.hasHighS())return!1;M&&(x=e.hash(x));let{r:X,s:et}=q,ot=A(x),Q=a(et),ht=c(ot*Q),tt=c(X*Q),Gt=f.BASE.multiplyAndAddUnsafe(G,ht,tt)?.toAffine();return Gt?c(Gt.x)===X:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:k,sign:$,verify:W,ProjectivePoint:f,Signature:w,utils:b}}var Ae=class extends Qt{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Tr(e);let r=ae(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return Xt(this),this.iHash.update(e),this}digestInto(e){Xt(this),nn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},gn=(t,e,n)=>new Ae(t,e).update(n).digest();gn.create=(t,e)=>new Ae(t,e);function ii(t){return{hash:t,hmac:(e,...n)=>gn(t,e,Lr(...n)),randomBytes:we}}function Mr(t,e){let n=r=>qr({...t,...ii(r)});return Object.freeze({...n(e),create:n})}var ke=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Se=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Dr=BigInt(1),Le=BigInt(2),Wr=(t,e)=>(t+e/Le)/e;function jr(t){let e=ke,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=t*t*t%e,l=f*f*t%e,u=nt(l,n,e)*l%e,g=nt(u,n,e)*l%e,y=nt(g,Le,e)*f%e,p=nt(y,o,e)*y%e,d=nt(p,s,e)*p%e,h=nt(d,c,e)*d%e,w=nt(h,a,e)*h%e,b=nt(w,c,e)*d%e,v=nt(b,n,e)*l%e,T=nt(v,i,e)*p%e,k=nt(T,r,e)*f%e,B=nt(k,Le,e);if(!wn.eql(wn.sqr(B),t))throw new Error("Cannot find square root");return B}var wn=Nr(ke,void 0,void 0,{sqrt:jr}),Rt=Mr({a:BigInt(0),b:BigInt(7),Fp:wn,n:Se,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=Se,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Dr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),c=Wr(s*t,e),a=Wr(-r*t,e),f=K(t-c*n-a*o,e),l=K(-c*r-a*s,e),u=f>i,g=l>i;if(u&&(f=e-f),g&&(l=e-l),f>i||l>i)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:f,k2neg:g,k2:l}}}},me),Ie=BigInt(0),zr=t=>typeof t=="bigint"&&Ie<t&&t<ke,ci=t=>typeof t=="bigint"&&Ie<t&&t<Se,Vr={};function _e(t,...e){let n=Vr[t];if(n===void 0){let r=me(Uint8Array.from(t,o=>o.charCodeAt(0)));n=vt(r,r),Vr[t]=n}return me(vt(n,...e))}var xn=t=>t.toRawBytes(!0).slice(1),bn=t=>lt(t,32),yn=t=>K(t,ke),le=t=>K(t,Se),vn=Rt.ProjectivePoint,ai=(t,e,n)=>vn.BASE.multiplyAndAddUnsafe(t,e,n);function mn(t){let e=Rt.utils.normPrivateKeyToScalar(t),n=vn.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:le(-e),bytes:xn(n)}}function Kr(t){if(!zr(t))throw new Error("bad x: need 0 < x < p");let e=yn(t*t),n=yn(e*t+BigInt(7)),r=jr(n);r%Le!==Ie&&(r=yn(-r));let o=new vn(t,r,Dr);return o.assertValidity(),o}function Zr(...t){return le(J(_e("BIP0340/challenge",...t)))}function fi(t){return mn(t).bytes}function li(t,e,n=we(32)){let r=z("message",t),{bytes:o,scalar:s}=mn(e),i=z("auxRand",n,32),c=bn(s^J(_e("BIP0340/aux",i))),a=_e("BIP0340/nonce",c,o,r),f=le(J(a));if(f===Ie)throw new Error("sign failed: k is zero");let{bytes:l,scalar:u}=mn(f),g=Zr(l,o,r),y=new Uint8Array(64);if(y.set(l,0),y.set(bn(le(u+g*s)),32),!Gr(y,r,o))throw new Error("sign: Invalid signature produced");return y}function Gr(t,e,n){let r=z("signature",t,64),o=z("message",e),s=z("publicKey",n,32);try{let i=Kr(J(s)),c=J(r.subarray(0,32));if(!zr(c))return!1;let a=J(r.subarray(32,64));if(!ci(a))return!1;let f=Zr(bn(c),xn(i),o),l=ai(i,a,le(-f));return!(!l||!l.hasEvenY()||l.toAffine().x!==c)}catch{return!1}}var Ft={getPublicKey:fi,sign:li,verify:Gr,utils:{randomPrivateKey:Rt.utils.randomPrivateKey,lift_x:Kr,pointToBytes:xn,numberToBytesBE:lt,bytesToNumberBE:J,taggedHash:_e,mod:K}};var Ue=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var En=t=>t instanceof Uint8Array;var Re=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ut=(t,e)=>t<<32-e|t>>>e,ui=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ui)throw new Error("Non little-endian hardware is not supported");var di=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function j(t){if(!En(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=di[t[n]];return e}function Bt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function hi(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ot(t){if(typeof t=="string"&&(t=hi(t)),!En(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function ee(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!En(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var te=class{clone(){return this._cloneInto()}};function Bn(t){let e=r=>t().update(Ot(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Oe(t=32){if(Ue&&typeof Ue.getRandomValues=="function")return Ue.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Tn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function pi(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Jr(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function gi(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Tn(t.outputLen),Tn(t.blockLen)}function yi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function wi(t,e){Jr(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var bi={number:Tn,bool:pi,bytes:Jr,hash:gi,exists:yi,output:wi},rt=bi;function mi(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var Ne=class extends te{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Re(this.buffer)}update(e){rt.exists(this);let{view:n,buffer:r,blockLen:o}=this;e=Ot(e);let s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=Re(e);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){rt.exists(this),rt.output(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;mi(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=Re(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,l[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return e.length=o,e.pos=c,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var xi=(t,e,n)=>t&e^~t&n,vi=(t,e,n)=>t&e^t&n^e&n,Ei=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Nt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ct=new Uint32Array(64),Ce=class extends Ne{constructor(){super(64,32,8,!1),this.A=Nt[0]|0,this.B=Nt[1]|0,this.C=Nt[2]|0,this.D=Nt[3]|0,this.E=Nt[4]|0,this.F=Nt[5]|0,this.G=Nt[6]|0,this.H=Nt[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[e,n,r,o,s,i,c,a]}set(e,n,r,o,s,i,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)Ct[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let g=Ct[u-15],y=Ct[u-2],p=ut(g,7)^ut(g,18)^g>>>3,d=ut(y,17)^ut(y,19)^y>>>10;Ct[u]=d+Ct[u-7]+p+Ct[u-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:l}=this;for(let u=0;u<64;u++){let g=ut(c,6)^ut(c,11)^ut(c,25),y=l+g+xi(c,a,f)+Ei[u]+Ct[u]|0,d=(ut(r,2)^ut(r,13)^ut(r,22))+vi(r,o,s)|0;l=f,f=a,a=c,c=i+y|0,i=s,s=o,o=r,r=y+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(r,o,s,i,c,a,f,l)}roundClean(){Ct.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},An=class extends Ce{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},gt=Bn(()=>new Ce),Gl=Bn(()=>new An);function ne(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Tt(...t){let e=(o,s)=>i=>o(s(i)),n=Array.from(t).reverse().reduce((o,s)=>o?e(o,s.encode):s.encode,void 0),r=t.reduce((o,s)=>o?e(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function At(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(ne(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function St(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Pe(t,e="="){if(ne(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function eo(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function Yr(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0,o=[],s=Array.from(t);for(s.forEach(i=>{if(ne(i),i<0||i>=e)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let a=r;a<s.length;a++){let f=s[a],l=e*i+f;if(!Number.isSafeInteger(l)||e*i/e!==i||l-f!==e*i)throw new Error("convertRadix: carry overflow");if(i=l%n,s[a]=Math.floor(l/n),!Number.isSafeInteger(s[a])||s[a]*n+i!==l)throw new Error("convertRadix: carry overflow");if(c)s[a]?c=!1:r=a;else continue}if(o.push(i),c)break}for(let i=0;i<t.length-1&&t[i]===0;i++)o.push(0);return o.reverse()}var no=(t,e)=>e?no(e,t%e):t,He=(t,e)=>t+(e-no(t,e));function Sn(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(He(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${He(e,n)}`);let o=0,s=0,i=2**n-1,c=[];for(let a of t){if(ne(a),a>=2**e)throw new Error(`convertRadix2: invalid data word=${a} from=${e}`);if(o=o<<e|a,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function Bi(t){return ne(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Yr(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Yr(e,t,2**8))}}}function Ht(t,e=!1){if(ne(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(He(8,t)>32||He(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Sn(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Sn(n,t,8,e))}}}function Xr(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}var Ti=Tt(Ht(4),At("0123456789ABCDEF"),St("")),Ai=Tt(Ht(5),At("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Pe(5),St("")),Yl=Tt(Ht(5),At("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Pe(5),St("")),Xl=Tt(Ht(5),At("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),St(""),eo(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),it=Tt(Ht(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Pe(6),St("")),Si=Tt(Ht(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Pe(6),St("")),kn=t=>Tt(Bi(58),At(t),St("")),Ln=kn("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Ql=kn("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Fl=kn("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),Qr=[0,2,3,5,6,7,9,10,11],Li={encode(t){let e="";for(let n=0;n<t.length;n+=8){let r=t.subarray(n,n+8);e+=Ln.encode(r).padStart(Qr[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){let r=t.slice(n,n+11),o=Qr.indexOf(r.length),s=Ln.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(e)}};var _n=Tt(At("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),St("")),Fr=[996825010,642813549,513874426,1027748829,705979059];function ue(t){let e=t>>25,n=(t&33554431)<<5;for(let r=0;r<Fr.length;r++)(e>>r&1)===1&&(n^=Fr[r]);return n}function to(t,e,n=1){let r=t.length,o=1;for(let s=0;s<r;s++){let i=t.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${t})`);o=ue(o)^i>>5}o=ue(o);for(let s=0;s<r;s++)o=ue(o)^t.charCodeAt(s)&31;for(let s of e)o=ue(o)^s;for(let s=0;s<6;s++)o=ue(o);return o^=n,_n.encode(Sn([o%2**30],30,5,!1))}function ro(t){let e=t==="bech32"?1:734539939,n=Ht(5),r=n.decode,o=n.encode,s=Xr(r);function i(l,u,g=90){if(typeof l!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof l}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);let y=l.length+7+u.length;if(g!==!1&&y>g)throw new TypeError(`Length ${y} exceeds limit ${g}`);return l=l.toLowerCase(),`${l}1${_n.encode(u)}${to(l,u,e)}`}function c(l,u=90){if(typeof l!="string")throw new Error(`bech32.decode input should be string, not ${typeof l}`);if(l.length<8||u!==!1&&l.length>u)throw new TypeError(`Wrong string length: ${l.length} (${l}). Expected (8..${u})`);let g=l.toLowerCase();if(l!==g&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");l=g;let y=l.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');let p=l.slice(0,y),d=l.slice(y+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");let h=_n.decode(d).slice(0,-6),w=to(p,h,e);if(!d.endsWith(w))throw new Error(`Invalid checksum in ${l}: expected "${w}"`);return{prefix:p,words:h}}let a=Xr(c);function f(l){let{prefix:u,words:g}=c(l,!1);return{prefix:u,words:g,bytes:r(g)}}return{encode:i,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:s,toWords:o}}var Pt=ro("bech32"),tu=ro("bech32m"),_i={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},ki=Tt(Ht(4),At("0123456789abcdef"),St(""),eo(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),Ii={utf8:_i,hex:ki,base16:Ti,base32:Ai,base64:it,base64url:Si,base58:Ln,base58xmr:Li},eu=`Invalid encoding type. Available types: ${Object.keys(Ii).join(", ")}`;function $e(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function In(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Un(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function C(t,...e){if(!Un(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function $t(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function de(t,e){C(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var qe=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength);var H=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),qt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ui=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ui)throw new Error("Non little-endian hardware is not supported");function Ri(t){if(typeof t!="string")throw new Error(`string expected, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function yt(t){if(typeof t=="string")t=Ri(t);else if(Un(t))t=t.slice();else throw new Error(`Uint8Array expected, got ${typeof t}`);return t}function oo(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Kt(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}var wt=(t,e)=>(Object.assign(e,t),e);function Zt(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var Lt=16,On=new Uint8Array(16),bt=H(On),Oi=225,Ni=(t,e,n,r)=>{let o=r&1;return{s3:n<<31|r>>>1,s2:e<<31|n>>>1,s1:t<<31|e>>>1,s0:t>>>1^Oi<<24&-(o&1)}},ct=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255|0;function Ci(t){t.reverse();let e=t[15]&1,n=0;for(let r=0;r<t.length;r++){let o=t[r];t[r]=o>>>1|n,n=(o&1)<<7}return t[0]^=-e&225,t}var Hi=t=>t>64*1024?8:t>1024?4:2,Me=class{constructor(e,n){this.blockLen=Lt,this.outputLen=Lt,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=yt(e),C(e,16);let r=qt(e),o=r.getUint32(0,!1),s=r.getUint32(4,!1),i=r.getUint32(8,!1),c=r.getUint32(12,!1),a=[];for(let p=0;p<128;p++)a.push({s0:ct(o),s1:ct(s),s2:ct(i),s3:ct(c)}),{s0:o,s1:s,s2:i,s3:c}=Ni(o,s,i,c);let f=Hi(n||1024);if(![1,2,4,8].includes(f))throw new Error(`ghash: wrong window size=${f}, should be 2, 4 or 8`);this.W=f;let u=128/f,g=this.windowSize=2**f,y=[];for(let p=0;p<u;p++)for(let d=0;d<g;d++){let h=0,w=0,b=0,v=0;for(let T=0;T<f;T++){if(!(d>>>f-T-1&1))continue;let{s0:B,s1:A,s2:L,s3:O}=a[f*p+T];h^=B,w^=A,b^=L,v^=O}y.push({s0:h,s1:w,s2:b,s3:v})}this.t=y}_updateBlock(e,n,r,o){e^=this.s0,n^=this.s1,r^=this.s2,o^=this.s3;let{W:s,t:i,windowSize:c}=this,a=0,f=0,l=0,u=0,g=(1<<s)-1,y=0;for(let p of[e,n,r,o])for(let d=0;d<4;d++){let h=p>>>8*d&255;for(let w=8/s-1;w>=0;w--){let b=h>>>s*w&g,{s0:v,s1:T,s2:k,s3:B}=i[y*c+b];a^=v,f^=T,l^=k,u^=B,y+=1}}this.s0=a,this.s1=f,this.s2=l,this.s3=u}update(e){e=yt(e),$t(this);let n=H(e),r=Math.floor(e.length/Lt),o=e.length%Lt;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return o&&(On.set(e.subarray(r*Lt)),this._updateBlock(bt[0],bt[1],bt[2],bt[3]),bt.fill(0)),this}destroy(){let{t:e}=this;for(let n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){$t(this),de(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e}digest(){let e=new Uint8Array(Lt);return this.digestInto(e),this.destroy(),e}},Rn=class extends Me{constructor(e,n){e=yt(e);let r=Ci(e.slice());super(r,n),r.fill(0)}update(e){e=yt(e),$t(this);let n=H(e),r=e.length%Lt,o=Math.floor(e.length/Lt);for(let s=0;s<o;s++)this._updateBlock(ct(n[s*4+3]),ct(n[s*4+2]),ct(n[s*4+1]),ct(n[s*4+0]));return r&&(On.set(e.subarray(o*Lt)),this._updateBlock(ct(bt[3]),ct(bt[2]),ct(bt[1]),ct(bt[0])),bt.fill(0)),this}digestInto(e){$t(this),de(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e.reverse()}};function so(t){let e=(r,o)=>t(o,r.length).update(yt(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,o)=>t(r,o),e}var Nn=so((t,e)=>new Me(t,e)),io=so((t,e)=>new Rn(t,e));var F=16,Pn=4,We=new Uint8Array(F),Pi=283;function $n(t){return t<<1^Pi&-(t>>7)}function re(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=$n(t);return n}var Hn=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=$n(r))t[n]=r;let e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),$i=Hn.map((t,e)=>Hn.indexOf(e)),qi=t=>t<<24|t>>>8,Cn=t=>t<<8|t>>>24;function co(t,e){if(t.length!==256)throw new Error("Wrong sbox length");let n=new Uint32Array(256).map((f,l)=>e(t[l])),r=n.map(Cn),o=r.map(Cn),s=o.map(Cn),i=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let f=0;f<256;f++)for(let l=0;l<256;l++){let u=f*256+l;i[u]=n[f]^r[l],c[u]=o[f]^s[l],a[u]=t[f]<<8|t[l]}return{sbox:t,sbox2:a,T0:n,T1:r,T2:o,T3:s,T01:i,T23:c}}var qn=co(Hn,t=>re(t,3)<<24|t<<16|t<<8|re(t,2)),ao=co($i,t=>re(t,11)<<24|re(t,13)<<16|re(t,9)<<8|re(t,14)),Mi=(()=>{let t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=$n(n))t[e]=n;return t})();function Wt(t){C(t);let e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);let{sbox2:n}=qn,r=H(t),o=r.length,s=c=>mt(n,c,c,c,c),i=new Uint32Array(e+28);i.set(r);for(let c=o;c<i.length;c++){let a=i[c-1];c%o===0?a=s(qi(a))^Mi[c/o-1]:o>6&&c%o===4&&(a=s(a)),i[c]=i[c-o]^a}return i}function fo(t){let e=Wt(t),n=e.slice(),r=e.length,{sbox2:o}=qn,{T0:s,T1:i,T2:c,T3:a}=ao;for(let f=0;f<r;f+=4)for(let l=0;l<4;l++)n[f+l]=e[r-f-4+l];e.fill(0);for(let f=4;f<r-4;f++){let l=n[f],u=mt(o,l,l,l,l);n[f]=s[u&255]^i[u>>>8&255]^c[u>>>16&255]^a[u>>>24]}return n}function Mt(t,e,n,r,o,s){return t[n<<8&65280|r>>>8&255]^e[o>>>8&65280|s>>>24&255]}function mt(t,e,n,r,o){return t[e&255|n&65280]|t[r>>>16&255|o>>>16&65280]<<16}function at(t,e,n,r,o){let{sbox2:s,T01:i,T23:c}=qn,a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];let f=t.length/4-2;for(let p=0;p<f;p++){let d=t[a++]^Mt(i,c,e,n,r,o),h=t[a++]^Mt(i,c,n,r,o,e),w=t[a++]^Mt(i,c,r,o,e,n),b=t[a++]^Mt(i,c,o,e,n,r);e=d,n=h,r=w,o=b}let l=t[a++]^mt(s,e,n,r,o),u=t[a++]^mt(s,n,r,o,e),g=t[a++]^mt(s,r,o,e,n),y=t[a++]^mt(s,o,e,n,r);return{s0:l,s1:u,s2:g,s3:y}}function lo(t,e,n,r,o){let{sbox2:s,T01:i,T23:c}=ao,a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];let f=t.length/4-2;for(let p=0;p<f;p++){let d=t[a++]^Mt(i,c,e,o,r,n),h=t[a++]^Mt(i,c,n,e,o,r),w=t[a++]^Mt(i,c,r,n,e,o),b=t[a++]^Mt(i,c,o,r,n,e);e=d,n=h,r=w,o=b}let l=t[a++]^mt(s,e,o,r,n),u=t[a++]^mt(s,n,e,o,r),g=t[a++]^mt(s,r,n,e,o),y=t[a++]^mt(s,o,r,n,e);return{s0:l,s1:u,s2:g,s3:y}}function oe(t,e){if(!e)return new Uint8Array(t);if(C(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function Wi(t,e,n,r){C(e,F),C(n);let o=n.length;r=oe(o,r);let s=e,i=H(s),{s0:c,s1:a,s2:f,s3:l}=at(t,i[0],i[1],i[2],i[3]),u=H(n),g=H(r);for(let p=0;p+4<=u.length;p+=4){g[p+0]=u[p+0]^c,g[p+1]=u[p+1]^a,g[p+2]=u[p+2]^f,g[p+3]=u[p+3]^l;let d=1;for(let h=s.length-1;h>=0;h--)d=d+(s[h]&255)|0,s[h]=d&255,d>>>=8;({s0:c,s1:a,s2:f,s3:l}=at(t,i[0],i[1],i[2],i[3]))}let y=F*Math.floor(u.length/Pn);if(y<o){let p=new Uint32Array([c,a,f,l]),d=qe(p);for(let h=y,w=0;h<o;h++,w++)r[h]=n[h]^d[w]}return r}function he(t,e,n,r,o){C(n,F),C(r),o=oe(r.length,o);let s=n,i=H(s),c=qt(s),a=H(r),f=H(o),l=e?0:12,u=r.length,g=c.getUint32(l,e),{s0:y,s1:p,s2:d,s3:h}=at(t,i[0],i[1],i[2],i[3]);for(let b=0;b+4<=a.length;b+=4)f[b+0]=a[b+0]^y,f[b+1]=a[b+1]^p,f[b+2]=a[b+2]^d,f[b+3]=a[b+3]^h,g=g+1>>>0,c.setUint32(l,g,e),{s0:y,s1:p,s2:d,s3:h}=at(t,i[0],i[1],i[2],i[3]);let w=F*Math.floor(a.length/Pn);if(w<u){let b=new Uint32Array([y,p,d,h]),v=qe(b);for(let T=w,k=0;T<u;T++,k++)o[T]=r[T]^v[k]}return o}var du=wt({blockSize:16,nonceLength:16},function(e,n){C(e),C(n,F);function r(o,s){let i=Wt(e),c=n.slice(),a=Wi(i,c,o,s);return i.fill(0),c.fill(0),a}return{encrypt:(o,s)=>r(o,s),decrypt:(o,s)=>r(o,s)}});function uo(t){if(C(t),t.length%F!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${F}`)}function ho(t,e,n){let r=t.length,o=r%F;if(!e&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let s=H(t);if(e){let a=F-o;a||(a=F),r=r+a}let i=oe(r,n),c=H(i);return{b:s,o:c,out:i}}function po(t,e){if(!e)return t;let n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");let r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);let o=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function go(t){let e=new Uint8Array(16),n=H(e);e.set(t);let r=F-t.length;for(let o=F-r;o<F;o++)e[o]=r;return n}var hu=wt({blockSize:16},function(e,n={}){C(e);let r=!n.disablePadding;return{encrypt:(o,s)=>{C(o);let{b:i,o:c,out:a}=ho(o,r,s),f=Wt(e),l=0;for(;l+4<=i.length;){let{s0:u,s1:g,s2:y,s3:p}=at(f,i[l+0],i[l+1],i[l+2],i[l+3]);c[l++]=u,c[l++]=g,c[l++]=y,c[l++]=p}if(r){let u=go(o.subarray(l*4)),{s0:g,s1:y,s2:p,s3:d}=at(f,u[0],u[1],u[2],u[3]);c[l++]=g,c[l++]=y,c[l++]=p,c[l++]=d}return f.fill(0),a},decrypt:(o,s)=>{uo(o);let i=fo(e),c=oe(o.length,s),a=H(o),f=H(c);for(let l=0;l+4<=a.length;){let{s0:u,s1:g,s2:y,s3:p}=lo(i,a[l+0],a[l+1],a[l+2],a[l+3]);f[l++]=u,f[l++]=g,f[l++]=y,f[l++]=p}return i.fill(0),po(c,r)}}}),Mn=wt({blockSize:16,nonceLength:16},function(e,n,r={}){C(e),C(n,16);let o=!r.disablePadding;return{encrypt:(s,i)=>{let c=Wt(e),{b:a,o:f,out:l}=ho(s,o,i),u=H(n),g=u[0],y=u[1],p=u[2],d=u[3],h=0;for(;h+4<=a.length;)g^=a[h+0],y^=a[h+1],p^=a[h+2],d^=a[h+3],{s0:g,s1:y,s2:p,s3:d}=at(c,g,y,p,d),f[h++]=g,f[h++]=y,f[h++]=p,f[h++]=d;if(o){let w=go(s.subarray(h*4));g^=w[0],y^=w[1],p^=w[2],d^=w[3],{s0:g,s1:y,s2:p,s3:d}=at(c,g,y,p,d),f[h++]=g,f[h++]=y,f[h++]=p,f[h++]=d}return c.fill(0),l},decrypt:(s,i)=>{uo(s);let c=fo(e),a=H(n),f=oe(s.length,i),l=H(s),u=H(f),g=a[0],y=a[1],p=a[2],d=a[3];for(let h=0;h+4<=l.length;){let w=g,b=y,v=p,T=d;g=l[h+0],y=l[h+1],p=l[h+2],d=l[h+3];let{s0:k,s1:B,s2:A,s3:L}=lo(c,g,y,p,d);u[h++]=k^w,u[h++]=B^b,u[h++]=A^v,u[h++]=L^T}return c.fill(0),po(f,o)}}}),pu=wt({blockSize:16,nonceLength:16},function(e,n){C(e),C(n,16);function r(o,s,i){let c=Wt(e),a=o.length;i=oe(a,i);let f=H(o),l=H(i),u=s?l:f,g=H(n),y=g[0],p=g[1],d=g[2],h=g[3];for(let b=0;b+4<=f.length;){let{s0:v,s1:T,s2:k,s3:B}=at(c,y,p,d,h);l[b+0]=f[b+0]^v,l[b+1]=f[b+1]^T,l[b+2]=f[b+2]^k,l[b+3]=f[b+3]^B,y=u[b++],p=u[b++],d=u[b++],h=u[b++]}let w=F*Math.floor(f.length/Pn);if(w<a){({s0:y,s1:p,s2:d,s3:h}=at(c,y,p,d,h));let b=qe(new Uint32Array([y,p,d,h]));for(let v=w,T=0;v<a;v++,T++)i[v]=o[v]^b[T];b.fill(0)}return c.fill(0),i}return{encrypt:(o,s)=>r(o,!0,s),decrypt:(o,s)=>r(o,!1,s)}});function yo(t,e,n,r,o){let s=t.create(n,r.length+(o?.length||0));o&&s.update(o),s.update(r);let i=new Uint8Array(16),c=qt(i);return o&&Zt(c,0,BigInt(o.length*8),e),Zt(c,8,BigInt(r.length*8),e),s.update(i),s.digest()}var gu=wt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){if(C(n),n.length===0)throw new Error("aes/gcm: empty nonce");let o=16;function s(c,a,f){let l=yo(Nn,!1,c,f,r);for(let u=0;u<a.length;u++)l[u]^=a[u];return l}function i(){let c=Wt(e),a=We.slice(),f=We.slice();if(he(c,!1,f,f,a),n.length===12)f.set(n);else{let u=We.slice(),g=qt(u);Zt(g,8,BigInt(n.length*8),!1),Nn.create(a).update(n).update(u).digestInto(f)}let l=he(c,!1,f,We);return{xk:c,authKey:a,counter:f,tagMask:l}}return{encrypt:c=>{C(c);let{xk:a,authKey:f,counter:l,tagMask:u}=i(),g=new Uint8Array(c.length+o);he(a,!1,l,c,g);let y=s(f,u,g.subarray(0,g.length-o));return g.set(y,c.length),a.fill(0),g},decrypt:c=>{if(C(c),c.length<o)throw new Error(`aes/gcm: ciphertext less than tagLen (${o})`);let{xk:a,authKey:f,counter:l,tagMask:u}=i(),g=c.subarray(0,-o),y=c.subarray(-o),p=s(f,u,g);if(!Kt(p,y))throw new Error("aes/gcm: invalid ghash tag");let d=he(a,!1,l,g);return f.fill(0),u.fill(0),a.fill(0),d}}}),Ve=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)},yu=wt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){let s=Ve("AAD",0,68719476736),i=Ve("plaintext",0,2**36),c=Ve("nonce",12,12),a=Ve("ciphertext",16,2**36+16);C(n),c(n.length),r&&(C(r),s(r.length));function f(){let g=e.length;if(g!==16&&g!==24&&g!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${g} bytes`);let y=Wt(e),p=new Uint8Array(g),d=new Uint8Array(16),h=H(n),w=0,b=h[0],v=h[1],T=h[2],k=0;for(let B of[d,p].map(H)){let A=H(B);for(let L=0;L<A.length;L+=2){let{s0:O,s1:U}=at(y,w,b,v,T);A[L+0]=O,A[L+1]=U,w=++k}}return y.fill(0),{authKey:d,encKey:Wt(p)}}function l(g,y,p){let d=yo(io,!0,y,p,r);for(let k=0;k<12;k++)d[k]^=n[k];d[15]&=127;let h=H(d),w=h[0],b=h[1],v=h[2],T=h[3];return{s0:w,s1:b,s2:v,s3:T}=at(g,w,b,v,T),h[0]=w,h[1]=b,h[2]=v,h[3]=T,d}function u(g,y,p){let d=y.slice();return d[15]|=128,he(g,!0,d,p)}return{encrypt:g=>{C(g),i(g.length);let{encKey:y,authKey:p}=f(),d=l(y,p,g),h=new Uint8Array(g.length+16);return h.set(d,g.length),h.set(u(y,d,g)),y.fill(0),p.fill(0),h},decrypt:g=>{C(g),a(g.length);let y=g.subarray(-16),{encKey:p,authKey:d}=f(),h=u(p,y,g.subarray(0,-16)),w=l(p,d,h);if(p.fill(0),d.fill(0),!Kt(y,w))throw new Error("invalid polyval tag");return h}}});var Y=(t,e)=>t[e++]&255|(t[e++]&255)<<8,Wn=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=yt(e),C(e,32);let n=Y(e,0),r=Y(e,2),o=Y(e,4),s=Y(e,6),i=Y(e,8),c=Y(e,10),a=Y(e,12),f=Y(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|c<<2)&8191,this.r[7]=(c>>>11|a<<5)&8065,this.r[8]=(a>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Y(e,16+2*l)}process(e,n,r=!1){let o=r?0:2048,{h:s,r:i}=this,c=i[0],a=i[1],f=i[2],l=i[3],u=i[4],g=i[5],y=i[6],p=i[7],d=i[8],h=i[9],w=Y(e,n+0),b=Y(e,n+2),v=Y(e,n+4),T=Y(e,n+6),k=Y(e,n+8),B=Y(e,n+10),A=Y(e,n+12),L=Y(e,n+14),O=s[0]+(w&8191),U=s[1]+((w>>>13|b<<3)&8191),I=s[2]+((b>>>10|v<<6)&8191),P=s[3]+((v>>>7|T<<9)&8191),$=s[4]+((T>>>4|k<<12)&8191),W=s[5]+(k>>>1&8191),m=s[6]+((k>>>14|B<<2)&8191),x=s[7]+((B>>>11|A<<5)&8191),_=s[8]+((A>>>8|L<<8)&8191),R=s[9]+(L>>>5|o),E=0,N=E+O*c+U*(5*h)+I*(5*d)+P*(5*p)+$*(5*y);E=N>>>13,N&=8191,N+=W*(5*g)+m*(5*u)+x*(5*l)+_*(5*f)+R*(5*a),E+=N>>>13,N&=8191;let M=E+O*a+U*c+I*(5*h)+P*(5*d)+$*(5*p);E=M>>>13,M&=8191,M+=W*(5*y)+m*(5*g)+x*(5*u)+_*(5*l)+R*(5*f),E+=M>>>13,M&=8191;let q=E+O*f+U*a+I*c+P*(5*h)+$*(5*d);E=q>>>13,q&=8191,q+=W*(5*p)+m*(5*y)+x*(5*g)+_*(5*u)+R*(5*l),E+=q>>>13,q&=8191;let G=E+O*l+U*f+I*a+P*c+$*(5*h);E=G>>>13,G&=8191,G+=W*(5*d)+m*(5*p)+x*(5*y)+_*(5*g)+R*(5*u),E+=G>>>13,G&=8191;let X=E+O*u+U*l+I*f+P*a+$*c;E=X>>>13,X&=8191,X+=W*(5*h)+m*(5*d)+x*(5*p)+_*(5*y)+R*(5*g),E+=X>>>13,X&=8191;let et=E+O*g+U*u+I*l+P*f+$*a;E=et>>>13,et&=8191,et+=W*c+m*(5*h)+x*(5*d)+_*(5*p)+R*(5*y),E+=et>>>13,et&=8191;let ot=E+O*y+U*g+I*u+P*l+$*f;E=ot>>>13,ot&=8191,ot+=W*a+m*c+x*(5*h)+_*(5*d)+R*(5*p),E+=ot>>>13,ot&=8191;let Q=E+O*p+U*y+I*g+P*u+$*l;E=Q>>>13,Q&=8191,Q+=W*f+m*a+x*c+_*(5*h)+R*(5*d),E+=Q>>>13,Q&=8191;let ht=E+O*d+U*p+I*y+P*g+$*u;E=ht>>>13,ht&=8191,ht+=W*l+m*f+x*a+_*c+R*(5*h),E+=ht>>>13,ht&=8191;let tt=E+O*h+U*d+I*p+P*y+$*g;E=tt>>>13,tt&=8191,tt+=W*u+m*l+x*f+_*a+R*c,E+=tt>>>13,tt&=8191,E=(E<<2)+E|0,E=E+N|0,N=E&8191,E=E>>>13,M+=E,s[0]=N,s[1]=M,s[2]=q,s[3]=G,s[4]=X,s[5]=et,s[6]=ot,s[7]=Q,s[8]=ht,s[9]=tt}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let c=2;c<10;c++)e[c]+=o,o=e[c]>>>13,e[c]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=e[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let s=(o^1)-1;for(let c=0;c<10;c++)r[c]&=s;s=~s;for(let c=0;c<10;c++)e[c]=e[c]&s|r[c];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let i=e[0]+n[0];e[0]=i&65535;for(let c=1;c<8;c++)i=(e[c]+n[c]|0)+(i>>>16)|0,e[c]=i&65535}update(e){$t(this);let{buffer:n,blockLen:r}=this;e=yt(e);let o=e.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){$t(this),de(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)e[s++]=r[i]>>>0,e[s++]=r[i]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function Vi(t){let e=(r,o)=>t(o).update(yt(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var wo=Vi(t=>new Wn(t));var mo=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Di=mo("expand 16-byte k"),ji=mo("expand 32-byte k"),zi=H(Di),xo=H(ji),Bu=xo.slice();function S(t,e){return t<<e|t>>>32-e}function Vn(t){return t.byteOffset%4===0}var De=64,Ki=16,vo=2**32-1,bo=new Uint32Array;function Zi(t,e,n,r,o,s,i,c){let a=o.length,f=new Uint8Array(De),l=H(f),u=Vn(o)&&Vn(s),g=u?H(o):bo,y=u?H(s):bo;for(let p=0;p<a;i++){if(t(e,n,r,l,i,c),i>=vo)throw new Error("arx: counter overflow");let d=Math.min(De,a-p);if(u&&d===De){let h=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let w=0,b;w<Ki;w++)b=h+w,y[b]=g[b]^l[w];p+=De;continue}for(let h=0,w;h<d;h++)w=p+h,s[w]=o[w]^f[h];p+=d}}function Dn(t,e){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=oo({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return $e(o),$e(i),In(s),In(n),(c,a,f,l,u=0)=>{C(c),C(a),C(f);let g=f.length;if(l||(l=new Uint8Array(g)),C(l),$e(u),u<0||u>=vo)throw new Error("arx: counter overflow");if(l.length<g)throw new Error(`arx: output (${l.length}) is shorter than data (${g})`);let y=[],p=c.length,d,h;if(p===32)d=c.slice(),y.push(d),h=xo;else if(p===16&&n)d=new Uint8Array(32),d.set(c),d.set(c,16),h=zi,y.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Vn(a)||(a=a.slice(),y.push(a));let w=H(d);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(h,w,H(a.subarray(0,16)),w),a=a.subarray(16)}let b=16-o;if(b!==a.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){let T=new Uint8Array(12);T.set(a,s?0:12-a.length),a=T,y.push(a)}let v=H(a);for(Zi(t,h,w,v,f,l,u,i);y.length>0;)y.pop().fill(0);return l}}function To(t,e,n,r,o,s=20){let i=t[0],c=t[1],a=t[2],f=t[3],l=e[0],u=e[1],g=e[2],y=e[3],p=e[4],d=e[5],h=e[6],w=e[7],b=o,v=n[0],T=n[1],k=n[2],B=i,A=c,L=a,O=f,U=l,I=u,P=g,$=y,W=p,m=d,x=h,_=w,R=b,E=v,N=T,M=k;for(let G=0;G<s;G+=2)B=B+U|0,R=S(R^B,16),W=W+R|0,U=S(U^W,12),B=B+U|0,R=S(R^B,8),W=W+R|0,U=S(U^W,7),A=A+I|0,E=S(E^A,16),m=m+E|0,I=S(I^m,12),A=A+I|0,E=S(E^A,8),m=m+E|0,I=S(I^m,7),L=L+P|0,N=S(N^L,16),x=x+N|0,P=S(P^x,12),L=L+P|0,N=S(N^L,8),x=x+N|0,P=S(P^x,7),O=O+$|0,M=S(M^O,16),_=_+M|0,$=S($^_,12),O=O+$|0,M=S(M^O,8),_=_+M|0,$=S($^_,7),B=B+I|0,M=S(M^B,16),x=x+M|0,I=S(I^x,12),B=B+I|0,M=S(M^B,8),x=x+M|0,I=S(I^x,7),A=A+P|0,R=S(R^A,16),_=_+R|0,P=S(P^_,12),A=A+P|0,R=S(R^A,8),_=_+R|0,P=S(P^_,7),L=L+$|0,E=S(E^L,16),W=W+E|0,$=S($^W,12),L=L+$|0,E=S(E^L,8),W=W+E|0,$=S($^W,7),O=O+U|0,N=S(N^O,16),m=m+N|0,U=S(U^m,12),O=O+U|0,N=S(N^O,8),m=m+N|0,U=S(U^m,7);let q=0;r[q++]=i+B|0,r[q++]=c+A|0,r[q++]=a+L|0,r[q++]=f+O|0,r[q++]=l+U|0,r[q++]=u+I|0,r[q++]=g+P|0,r[q++]=y+$|0,r[q++]=p+W|0,r[q++]=d+m|0,r[q++]=h+x|0,r[q++]=w+_|0,r[q++]=b+R|0,r[q++]=v+E|0,r[q++]=T+N|0,r[q++]=k+M|0}function Gi(t,e,n,r){let o=t[0],s=t[1],i=t[2],c=t[3],a=e[0],f=e[1],l=e[2],u=e[3],g=e[4],y=e[5],p=e[6],d=e[7],h=n[0],w=n[1],b=n[2],v=n[3];for(let k=0;k<20;k+=2)o=o+a|0,h=S(h^o,16),g=g+h|0,a=S(a^g,12),o=o+a|0,h=S(h^o,8),g=g+h|0,a=S(a^g,7),s=s+f|0,w=S(w^s,16),y=y+w|0,f=S(f^y,12),s=s+f|0,w=S(w^s,8),y=y+w|0,f=S(f^y,7),i=i+l|0,b=S(b^i,16),p=p+b|0,l=S(l^p,12),i=i+l|0,b=S(b^i,8),p=p+b|0,l=S(l^p,7),c=c+u|0,v=S(v^c,16),d=d+v|0,u=S(u^d,12),c=c+u|0,v=S(v^c,8),d=d+v|0,u=S(u^d,7),o=o+f|0,v=S(v^o,16),p=p+v|0,f=S(f^p,12),o=o+f|0,v=S(v^o,8),p=p+v|0,f=S(f^p,7),s=s+l|0,h=S(h^s,16),d=d+h|0,l=S(l^d,12),s=s+l|0,h=S(h^s,8),d=d+h|0,l=S(l^d,7),i=i+u|0,w=S(w^i,16),g=g+w|0,u=S(u^g,12),i=i+u|0,w=S(w^i,8),g=g+w|0,u=S(u^g,7),c=c+a|0,b=S(b^c,16),y=y+b|0,a=S(a^y,12),c=c+a|0,b=S(b^c,8),y=y+b|0,a=S(a^y,7);let T=0;r[T++]=o,r[T++]=s,r[T++]=i,r[T++]=c,r[T++]=h,r[T++]=w,r[T++]=b,r[T++]=v}var je=Dn(To,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Ji=Dn(To,{counterRight:!1,counterLength:8,extendNonceFn:Gi,allowShortKeys:!1});var Yi=new Uint8Array(16),Eo=(t,e)=>{t.update(e);let n=e.length%16;n&&t.update(Yi.subarray(n))},Xi=new Uint8Array(32);function Bo(t,e,n,r,o){let s=t(e,n,Xi),i=wo.create(s);o&&Eo(i,o),Eo(i,r);let c=new Uint8Array(16),a=qt(c);Zt(a,0,BigInt(o?o.length:0),!0),Zt(a,8,BigInt(r.length),!0),i.update(c);let f=i.digest();return s.fill(0),f}var Ao=t=>(e,n,r)=>(C(e,32),C(n),{encrypt:(s,i)=>{let c=s.length,a=c+16;i?C(i,a):i=new Uint8Array(a),t(e,n,s,i,1);let f=Bo(t,e,n,i.subarray(0,-16),r);return i.set(f,c),i},decrypt:(s,i)=>{let c=s.length,a=c-16;if(c<16)throw new Error("encrypted data must be at least 16 bytes");i?C(i,a):i=new Uint8Array(a);let f=s.subarray(0,-16),l=s.subarray(-16),u=Bo(t,e,n,f,r);if(!Kt(l,u))throw new Error("invalid tag");return t(e,n,f,i,1),i}}),ku=wt({blockSize:64,nonceLength:12,tagLength:16},Ao(je)),Iu=wt({blockSize:64,nonceLength:24,tagLength:16},Ao(Ji));var ze=class extends te{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,rt.hash(e);let r=Ot(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return rt.exists(this),this.iHash.update(e),this}digestInto(e){rt.exists(this),rt.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},se=(t,e,n)=>new ze(t,e).update(n).digest();se.create=(t,e)=>new ze(t,e);function Lo(t,e,n){return rt.hash(t),n===void 0&&(n=new Uint8Array(t.outputLen)),se(t,Ot(n),Ot(e))}var jn=new Uint8Array([0]),So=new Uint8Array;function _o(t,e,n,r=32){if(rt.hash(t),rt.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(r/t.outputLen);n===void 0&&(n=So);let s=new Uint8Array(o*t.outputLen),i=se.create(t,e),c=i._cloneInto(),a=new Uint8Array(i.outputLen);for(let f=0;f<o;f++)jn[0]=f+1,c.update(f===0?So:a).update(n).update(jn).digestInto(a),s.set(a,t.outputLen*f),i._cloneInto(c);return i.destroy(),c.destroy(),a.fill(0),jn.fill(0),s.slice(0,r)}var Qi=Object.defineProperty,V=(t,e)=>{for(var n in e)Qi(t,n,{get:e[n],enumerable:!0})},ie=Symbol("verified"),Fi=t=>t instanceof Object;function Kn(t){if(!Fi(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var tc={};V(tc,{Queue:()=>oc,QueueNode:()=>Uo,binarySearch:()=>Zn,bytesToHex:()=>j,hexToBytes:()=>Bt,insertEventIntoAscendingList:()=>rc,insertEventIntoDescendingList:()=>nc,normalizeURL:()=>ec,utf8Decoder:()=>_t,utf8Encoder:()=>dt});var _t=new TextDecoder("utf-8"),dt=new TextEncoder;function ec(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function nc(t,e){let[n,r]=Zn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:o.created_at-e.created_at);return r||t.splice(n,0,e),t}function rc(t,e){let[n,r]=Zn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:e.created_at-o.created_at);return r||t.splice(n,0,e),t}function Zn(t,e){let n=0,r=t.length-1;for(;n<=r;){let o=Math.floor((n+r)/2),s=e(t[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var Uo=class{constructor(t){Yt(this,"value");Yt(this,"next",null);Yt(this,"prev",null);this.value=t}},oc=class{constructor(){Yt(this,"first");Yt(this,"last");this.first=null,this.last=null}enqueue(t){let e=new Uo(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let e=this.first;return this.first=null,this.last=null,e.value}let t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},sc=class{generateSecretKey(){return Ft.utils.randomPrivateKey()}getPublicKey(t){return j(Ft.getPublicKey(t))}finalizeEvent(t,e){let n=t;return n.pubkey=j(Ft.getPublicKey(e)),n.id=Ke(n),n.sig=j(Ft.sign(Ke(n),e)),n[ie]=!0,n}verifyEvent(t){if(typeof t[ie]=="boolean")return t[ie];let e=Ke(t);if(e!==t.id)return t[ie]=!1,!1;try{let n=Ft.verify(t.sig,e,t.pubkey);return t[ie]=n,n}catch{return t[ie]=!1,!1}}};function ic(t){if(!Kn(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Ke(t){let e=gt(dt.encode(ic(t)));return j(e)}var Ge=new sc,cc=Ge.generateSecretKey,Gn=Ge.getPublicKey,xt=Ge.finalizeEvent,Jn=Ge.verifyEvent,ac={};V(ac,{Application:()=>ca,BadgeAward:()=>yc,BadgeDefinition:()=>ta,BlockedRelaysList:()=>$c,BookmarkList:()=>Cc,Bookmarksets:()=>Xc,Calendar:()=>pa,CalendarEventRSVP:()=>ga,ChannelCreation:()=>Po,ChannelHideMessage:()=>Mo,ChannelMessage:()=>qo,ChannelMetadata:()=>$o,ChannelMuteUser:()=>Wo,ClassifiedListing:()=>la,ClientAuth:()=>Do,CommunitiesList:()=>Hc,CommunityDefinition:()=>ba,CommunityPostApproval:()=>Tc,Contacts:()=>hc,CreateOrUpdateProduct:()=>ra,CreateOrUpdateStall:()=>na,Curationsets:()=>Qc,Date:()=>da,DirectMessageRelaysList:()=>Vc,DraftClassifiedListing:()=>ua,DraftLong:()=>sa,Emojisets:()=>ia,EncryptedDirectMessage:()=>pc,EventDeletion:()=>gc,FileMetadata:()=>bc,FileServerPreference:()=>Dc,Followsets:()=>Gc,GenericRepost:()=>tr,Genericlists:()=>Jc,GiftWrap:()=>Vo,HTTPAuth:()=>er,Handlerinformation:()=>wa,Handlerrecommendation:()=>ya,Highlights:()=>Uc,InterestsList:()=>Mc,Interestsets:()=>ea,JobFeedback:()=>Lc,JobRequest:()=>Ac,JobResult:()=>Sc,Label:()=>Bc,LightningPubRPC:()=>zc,LiveChatMessage:()=>mc,LiveEvent:()=>aa,LongFormArticle:()=>oa,Metadata:()=>uc,Mutelist:()=>Rc,NWCWalletInfo:()=>jc,NWCWalletRequest:()=>jo,NWCWalletResponse:()=>Kc,NostrConnect:()=>Zc,OpenTimestamps:()=>wc,Pinlist:()=>Oc,PrivateDirectMessage:()=>Ho,ProblemTracker:()=>xc,ProfileBadges:()=>Fc,PublicChatsList:()=>Pc,Reaction:()=>Fn,RecommendRelay:()=>dc,RelayList:()=>Nc,Relaysets:()=>Yc,Report:()=>vc,Reporting:()=>Ec,Repost:()=>Qn,Seal:()=>Co,SearchRelaysList:()=>qc,ShortTextNote:()=>No,Time:()=>ha,UserEmojiList:()=>Wc,UserStatuses:()=>fa,Zap:()=>Ic,ZapGoal:()=>_c,ZapRequest:()=>kc,classifyKind:()=>fc,isAddressableKind:()=>Xn,isEphemeralKind:()=>Oo,isKind:()=>lc,isRegularKind:()=>Ro,isReplaceableKind:()=>Yn});function Ro(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function Yn(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function Oo(t){return 2e4<=t&&t<3e4}function Xn(t){return 3e4<=t&&t<4e4}function fc(t){return Ro(t)?"regular":Yn(t)?"replaceable":Oo(t)?"ephemeral":Xn(t)?"parameterized":"unknown"}function lc(t,e){let n=e instanceof Array?e:[e];return Kn(t)&&n.includes(t.kind)||!1}var uc=0,No=1,dc=2,hc=3,pc=4,gc=5,Qn=6,Fn=7,yc=8,Co=13,Ho=14,tr=16,Po=40,$o=41,qo=42,Mo=43,Wo=44,wc=1040,Vo=1059,bc=1063,mc=1311,xc=1971,vc=1984,Ec=1984,Bc=1985,Tc=4550,Ac=5999,Sc=6999,Lc=7e3,_c=9041,kc=9734,Ic=9735,Uc=9802,Rc=1e4,Oc=10001,Nc=10002,Cc=10003,Hc=10004,Pc=10005,$c=10006,qc=10007,Mc=10015,Wc=10030,Vc=10050,Dc=10096,jc=13194,zc=21e3,Do=22242,jo=23194,Kc=23195,Zc=24133,er=27235,Gc=3e4,Jc=30001,Yc=30002,Xc=30003,Qc=30004,Fc=30008,ta=30009,ea=30015,na=30017,ra=30018,oa=30023,sa=30024,ia=30030,ca=30078,aa=30311,fa=30315,la=30402,ua=30403,da=31922,ha=31923,pa=31924,ga=31925,ya=31989,wa=31990,ba=34550;var ma={};V(ma,{getHex64:()=>nr,getInt:()=>zo,getSubscriptionId:()=>xa,matchEventId:()=>va,matchEventKind:()=>Ba,matchEventPubkey:()=>Ea});function nr(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function zo(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function xa(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return t.slice(r+1,s)}function va(t,e){return e===nr(t,"id")}function Ea(t,e){return e===nr(t,"pubkey")}function Ba(t,e){return e===zo(t,"kind")}var Ta={};V(Ta,{makeAuthEvent:()=>Aa});function Aa(t,e){return{kind:Do,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var Sa;try{Sa=WebSocket}catch{}var La;try{La=WebSocket}catch{}var rr={};V(rr,{BECH32_REGEX:()=>Ko,Bech32MaxSize:()=>or,NostrTypeGuard:()=>_a,decode:()=>Je,decodeNostrURI:()=>Ia,encodeBytes:()=>Xe,naddrEncode:()=>Ha,neventEncode:()=>Ca,noteEncode:()=>Oa,nprofileEncode:()=>Na,npubEncode:()=>Ra,nsecEncode:()=>Ua});var _a={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},or=5e3,Ko=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ka(t){let e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function Ia(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),Je(t)}catch{return{type:"invalid",data:null}}}function Je(t){let{prefix:e,words:n}=Pt.decode(t,or),r=new Uint8Array(Pt.fromWords(n));switch(e){case"nprofile":{let o=zn(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:j(o[0][0]),relays:o[1]?o[1].map(s=>_t.decode(s)):[]}}}case"nevent":{let o=zn(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:j(o[0][0]),relays:o[1]?o[1].map(s=>_t.decode(s)):[],author:o[2]?.[0]?j(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(j(o[3][0]),16):void 0}}}case"naddr":{let o=zn(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:_t.decode(o[0][0]),pubkey:j(o[2][0]),kind:parseInt(j(o[3][0]),16),relays:o[1]?o[1].map(s=>_t.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:j(r)};default:throw new Error(`unknown prefix ${e}`)}}function zn(t){let e={},n=t;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function Ua(t){return Xe("nsec",t)}function Ra(t){return Xe("npub",Bt(t))}function Oa(t){return Xe("note",Bt(t))}function Ye(t,e){let n=Pt.toWords(e);return Pt.encode(t,n,or)}function Xe(t,e){return Ye(t,e)}function Na(t){let e=sr({0:[Bt(t.pubkey)],1:(t.relays||[]).map(n=>dt.encode(n))});return Ye("nprofile",e)}function Ca(t){let e;t.kind!==void 0&&(e=ka(t.kind));let n=sr({0:[Bt(t.id)],1:(t.relays||[]).map(r=>dt.encode(r)),2:t.author?[Bt(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return Ye("nevent",n)}function Ha(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=sr({0:[dt.encode(t.identifier)],1:(t.relays||[]).map(r=>dt.encode(r)),2:[Bt(t.pubkey)],3:[new Uint8Array(e)]});return Ye("naddr",n)}function sr(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),e.push(s)})}),ee(...e)}var Pa={};V(Pa,{decrypt:()=>$a,encrypt:()=>Zo});function Zo(t,e,n){let r=t instanceof Uint8Array?j(t):t,o=Rt.getSharedSecret(r,"02"+e),s=Go(o),i=Uint8Array.from(Oe(16)),c=dt.encode(n),a=Mn(s,i).encrypt(c),f=it.encode(new Uint8Array(a)),l=it.encode(new Uint8Array(i.buffer));return`${f}?iv=${l}`}function $a(t,e,n){let r=t instanceof Uint8Array?j(t):t,[o,s]=n.split("?iv="),i=Rt.getSharedSecret(r,"02"+e),c=Go(i),a=it.decode(s),f=it.decode(o),l=Mn(c,a).decrypt(f);return _t.decode(l)}function Go(t){return t.slice(1,33)}var qa={};V(qa,{NIP05_REGEX:()=>ir,isNip05:()=>Ma,isValid:()=>Da,queryProfile:()=>Jo,searchDomain:()=>Va,useFetchImplementation:()=>Wa});var ir=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Ma=t=>ir.test(t||""),Qe;try{Qe=fetch}catch{}function Wa(t){Qe=t}async function Va(t,e=""){try{let n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Qe(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Jo(t){let e=t.match(ir);if(!e)return null;let[,n="_",r]=e;try{let o=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Qe(o,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");let i=await s.json(),c=i.names[n];return c?{pubkey:c,relays:i.relays?.[c]}:null}catch{return null}}async function Da(t,e){let n=await Jo(e);return n?n.pubkey===t:!1}var ja={};V(ja,{parse:()=>za});function za(t){let e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]},n,r;for(let o=t.tags.length-1;o>=0;o--){let s=t.tags[o];if(s[0]==="e"&&s[1]){let[i,c,a,f,l]=s,u={id:c,relays:a?[a]:[],author:l};if(f==="root"){e.root=u;continue}if(f==="reply"){e.reply=u;continue}if(f==="mention"){e.mentions.push(u);continue}n?r=u:n=u,e.mentions.push(u);continue}if(s[0]==="q"&&s[1]){let[i,c,a]=s;e.quotes.push({id:c,relays:a?[a]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(o=>{if(!o)return;let s=e.mentions.indexOf(o);if(s!==-1&&e.mentions.splice(s,1),o.author){let i=e.profiles.find(c=>c.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(c=>{o.relays?.indexOf(c)===-1&&o.relays.push(c)}),i.relays=o.relays)}}),e.mentions.forEach(o=>{if(o.author){let s=e.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),e}var Ka={};V(Ka,{fetchRelayInformation:()=>Ga,useFetchImplementation:()=>Za});var Yo;try{Yo=fetch}catch{}function Za(t){Yo=t}async function Ga(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var Ja={};V(Ja,{fastEventHash:()=>Qo,getPow:()=>Xo,minePow:()=>Ya});function Xo(t){let e=0;for(let n=0;n<64;n+=8){let r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function Ya(t,e){let n=0,r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){let s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=Qo(r),Xo(r.id)>=e)break}return r}function Qo(t){return j(gt(dt.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var Xa={};V(Xa,{unwrapEvent:()=>lf,unwrapManyEvents:()=>uf,wrapEvent:()=>us,wrapManyEvents:()=>ff});var Qa={};V(Qa,{createRumor:()=>cs,createSeal:()=>as,createWrap:()=>fs,unwrapEvent:()=>ur,unwrapManyEvents:()=>ls,wrapEvent:()=>Ze,wrapManyEvents:()=>cf});var Fa={};V(Fa,{decrypt:()=>lr,encrypt:()=>fr,getConversationKey:()=>cr,v2:()=>of});var Fo=1,ts=65535;function cr(t,e){let n=Rt.getSharedSecret(t,"02"+e).subarray(1,33);return Lo(gt,n,"nip44-v2")}function es(t,e){let n=_o(gt,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function ar(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;let e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function tf(t){if(!Number.isSafeInteger(t)||t<Fo||t>ts)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function ef(t){let e=dt.encode(t),n=e.length,r=tf(n),o=new Uint8Array(ar(n)-n);return ee(r,e,o)}function nf(t){let e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Fo||e>ts||n.length!==e||t.length!==2+ar(e))throw new Error("invalid padding");return _t.decode(n)}function ns(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=ee(n,e);return se(gt,t,r)}function rf(t){if(typeof t!="string")throw new Error("payload must be a valid string");let e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=it.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function fr(t,e,n=Oe(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:s}=es(e,n),i=ef(t),c=je(r,o,i),a=ns(s,c,n);return it.encode(ee(new Uint8Array([2]),n,c,a))}function lr(t,e){let{nonce:n,ciphertext:r,mac:o}=rf(t),{chacha_key:s,chacha_nonce:i,hmac_key:c}=es(e,n),a=ns(c,r,n);if(!Kt(a,o))throw new Error("invalid MAC");let f=je(s,i,r);return nf(f)}var of={utils:{getConversationKey:cr,calcPaddedLen:ar},encrypt:fr,decrypt:lr},sf=2880*60,rs=()=>Math.round(Date.now()/1e3),os=()=>Math.round(rs()-Math.random()*sf),ss=(t,e)=>cr(t,e),is=(t,e,n)=>fr(JSON.stringify(t),ss(e,n)),ko=(t,e)=>JSON.parse(lr(t.content,ss(e,t.pubkey)));function cs(t,e){let n={created_at:rs(),content:"",tags:[],...t,pubkey:Gn(e)};return n.id=Ke(n),n}function as(t,e,n){return xt({kind:Co,content:is(t,e,n),created_at:os(),tags:[]},e)}function fs(t,e){let n=cc();return xt({kind:Vo,content:is(t,n,e),created_at:os(),tags:[["p",e]]},n)}function Ze(t,e,n){let r=cs(t,e),o=as(r,e,n);return fs(o,n)}function cf(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");let r=Gn(e),o=[Ze(t,e,r)];return n.forEach(s=>{o.push(Ze(t,e,s))}),o}function ur(t,e){let n=ko(t,e);return ko(n,e)}function ls(t,e){let n=[];return t.forEach(r=>{n.push(ur(r,e))}),n.sort((r,o)=>r.created_at-o.created_at),n}function af(t,e,n,r){let o={created_at:Math.ceil(Date.now()/1e3),kind:Ho,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:i,relayUrl:c})=>{o.tags.push(c?["p",i,c]:["p",i])}),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function us(t,e,n,r,o){let s=af(e,n,r,o);return Ze(s,t,e.publicKey)}function ff(t,e,n,r,o){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Gn(t)},...e].map(i=>us(t,i,n,r,o))}var lf=ur,uf=ls,df={};V(df,{finishRepostEvent:()=>hf,getRepostedEvent:()=>pf,getRepostedEventPointer:()=>ds});function hf(t,e,n,r){let o,s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===No?o=Qn:(o=tr,s.push(["k",String(e.kind)])),xt({kind:o,tags:s,content:t.content===""||e.tags?.find(i=>i[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function ds(t){if(![Qn,tr].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function pf(t,{skipVerification:e}={}){let n=ds(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!Jn(r)))return r}var gf={};V(gf,{NOSTR_URI_REGEX:()=>dr,parse:()=>wf,test:()=>yf});var dr=new RegExp(`nostr:(${Ko.source})`);function yf(t){return typeof t=="string"&&new RegExp(`^${dr.source}$`).test(t)}function wf(t){let e=t.match(new RegExp(`^${dr.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Je(e[1])}}var bf={};V(bf,{finishReactionEvent:()=>mf,getReactedEventPointer:()=>xf});function mf(t,e,n){let r=e.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return xt({...t,kind:Fn,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function xf(t){if(t.kind!==Fn)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var vf={};V(vf,{parse:()=>Bf});var Ef=/\W/m,Io=/\W |\W$|$|,| /m;function*Bf(t){let e=t.length,n=0,r=0;for(;r<e;){let o=t.indexOf(":",r);if(o===-1)break;if(t.substring(o-5,o)==="nostr"){let s=t.substring(o+60).match(Ef),i=s?o+60+s.index:e;try{let c,{data:a,type:f}=Je(t.substring(o+1,i));switch(f){case"npub":c={pubkey:a};break;case"nsec":case"note":r=i+1;continue;default:c=a}n!==o-5&&(yield{type:"text",text:t.substring(n,o-5)}),yield{type:"reference",pointer:c},r=i,n=r;continue}catch{r=o+1;continue}}else if(t.substring(o-5,o)==="https"||t.substring(o-4,o)==="http"){let s=t.substring(o+4).match(Io),i=s?o+4+s.index:e,c=t[o-1]==="s"?5:4;try{let a=new URL(t.substring(o-c,i));if(a.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-c&&(yield{type:"text",text:t.substring(n,o-c)}),/\.(png|jpe?g|gif|webp)$/i.test(a.pathname)){yield{type:"image",url:a.toString()},r=i,n=r;continue}if(/\.(mp4|avi|webm|mkv)$/i.test(a.pathname)){yield{type:"video",url:a.toString()},r=i,n=r;continue}if(/\.(mp3|aac|ogg|opus)$/i.test(a.pathname)){yield{type:"audio",url:a.toString()},r=i,n=r;continue}yield{type:"url",url:a.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else if(t.substring(o-3,o)==="wss"||t.substring(o-2,o)==="ws"){let s=t.substring(o+4).match(Io),i=s?o+4+s.index:e,c=t[o-1]==="s"?3:2;try{let a=new URL(t.substring(o-c,i));if(a.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-c&&(yield{type:"text",text:t.substring(n,o-c)}),yield{type:"relay",url:a.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else{r=o+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var Tf={};V(Tf,{channelCreateEvent:()=>Af,channelHideMessageEvent:()=>_f,channelMessageEvent:()=>Lf,channelMetadataEvent:()=>Sf,channelMuteUserEvent:()=>kf});var Af=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:Po,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Sf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:$o,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Lf=(t,e)=>{let n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),xt({kind:qo,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},_f=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:Mo,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},kf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:Wo,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},If={};V(If,{EMOJI_SHORTCODE_REGEX:()=>hs,matchAll:()=>Uf,regex:()=>hr,replaceAll:()=>Rf});var hs=/:(\w+):/,hr=()=>new RegExp(`\\B${hs.source}\\B`,"g");function*Uf(t){let e=t.matchAll(hr());for(let n of e)try{let[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Rf(t,e){return t.replaceAll(hr(),(n,r)=>e({shortcode:n,name:r}))}var Of={};V(Of,{useFetchImplementation:()=>Nf,validateGithub:()=>Cf});var pr;try{pr=fetch}catch{}function Nf(t){pr=t}async function Cf(t,e,n){try{return await(await pr(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var Hf={};V(Hf,{makeNwcRequestEvent:()=>$f,parseConnectionString:()=>Pf});function Pf(t){let{host:e,pathname:n,searchParams:r}=new URL(t),o=n||e,s=r.get("relay"),i=r.get("secret");if(!o||!s||!i)throw new Error("invalid connection string");return{pubkey:o,relay:s,secret:i}}async function $f(t,e,n){let o=Zo(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:jo,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return xt(s,e)}var qf={};V(qf,{normalizeIdentifier:()=>Mf});function Mf(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>/\p{Letter}/u.test(e)||/\p{Number}/u.test(e)?e:"-").join("")}var Wf={};V(Wf,{getSatoshisAmountFromBolt11:()=>Zf,getZapEndpoint:()=>Df,makeZapReceipt:()=>Kf,makeZapRequest:()=>jf,useFetchImplementation:()=>Vf,validateZapRequest:()=>zf});var gr;try{gr=fetch}catch{}function Vf(t){gr=t}async function Df(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(r){let[i,c]=r.split("@");e=new URL(`/.well-known/lnurlp/${i}`,`https://${c}`).toString()}else if(n){let{words:i}=Pt.decode(n,1e3),c=Pt.fromWords(i);e=_t.decode(c)}else return null;let s=await(await gr(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function jf(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),Yn(t.event.kind)){let n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(Xn(t.event.kind)){let n=t.event.tags.find(([o,s])=>o==="d"&&s);if(!n)throw new Error("d tag not found or is empty");let r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function zf(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!Kn(e))return"Zap request is not a valid Nostr event.";if(!Jn(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function Kf({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),s=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&i.tags.push(["preimage",e]),i}function Zf(t){if(t.length<50)return 0;t=t.substring(0,50);let e=t.lastIndexOf("1");if(e===-1)return 0;let n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;let r=n.substring(4);if(r.length<1)return 0;let o=r[r.length-1],s=o.charCodeAt(0)-48,i=s>=0&&s<=9,c=r.length-1;if(i&&c++,c<1)return 0;let a=parseInt(r.substring(0,c));switch(o){case"m":return a*1e5;case"u":return a*100;case"n":return a/10;case"p":return a/1e4;default:return a*1e8}}var Gf={};V(Gf,{getToken:()=>Jf,hashPayload:()=>yr,unpackEventFromToken:()=>gs,validateEvent:()=>vs,validateEventKind:()=>ws,validateEventMethodTag:()=>ms,validateEventPayloadTag:()=>xs,validateEventTimestamp:()=>ys,validateEventUrlTag:()=>bs,validateToken:()=>Yf});var ps="Nostr ";async function Jf(t,e,n,r=!1,o){let s={kind:er,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",yr(o)]);let i=await n(s);return(r?ps:"")+it.encode(dt.encode(JSON.stringify(i)))}async function Yf(t,e,n){let r=await gs(t).catch(s=>{throw s});return await vs(r,e,n).catch(s=>{throw s})}async function gs(t){if(!t)throw new Error("Missing token");t=t.replace(ps,"");let e=_t.decode(it.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function ys(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function ws(t){return t.kind===er}function bs(t,e){let n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function ms(t,e){let n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function yr(t){let e=gt(dt.encode(JSON.stringify(t)));return j(e)}function xs(t,e){let n=t.tags.find(o=>o[0]==="payload");if(!n)return!1;let r=yr(e);return n.length>0&&n[1]===r}async function vs(t,e,n,r){if(!Jn(t))throw new Error("Invalid nostr event, signature invalid");if(!ws(t))throw new Error("Invalid nostr event, kind invalid");if(!ys(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!bs(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!ms(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!xs(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function Es(t){try{let e=rr.decode(t);return e.type==="nevent"?{type:"event",data:{id:e.data.id,relays:e.data.relays||[]}}:e.type==="note"?{type:"event",data:{id:e.data,relays:[]}}:e.type==="naddr"?{type:"address",data:{kind:e.data.kind,pubkey:e.data.pubkey,identifier:e.data.identifier,relays:e.data.relays||[]}}:null}catch(e){return console.error("[Nostr Decoder] Failed to decode identifier:",e),null}}function Xf(){return["wss://relay.divine.video","wss://relay.nostr.band","wss://relay.damus.io"]}function Bs(t=[],e=[]){let n=[...e,...t,...Xf()];return[...new Set(n)]}var Fe=class{constructor(e){this.relays=e,this.connections=new Map,this.subscriptions=new Map}async connectRelay(e){return new Promise((n,r)=>{let o=setTimeout(()=>{r(new Error(`Connection timeout: ${e}`))},1e4);try{let s=new WebSocket(e);s.onopen=()=>{clearTimeout(o),console.log(`[Nostr Client] Connected to ${e}`),this.connections.set(e,s),n(s)},s.onerror=i=>{clearTimeout(o),console.error(`[Nostr Client] Connection error ${e}:`,i),r(i)},s.onclose=()=>{console.log(`[Nostr Client] Disconnected from ${e}`),this.connections.delete(e)}}catch(s){clearTimeout(o),r(s)}})}async fetchEvent(e){let n=`embed-${Date.now()}`,r;if(e.type==="event")r={ids:[e.data.id]};else if(e.type==="address")r={kinds:[e.data.kind],authors:[e.data.pubkey],"#d":[e.data.identifier]};else throw new Error("Invalid identifier type");console.log("[Nostr Client] Fetching event with filter:",r);let o=this.relays.map(i=>this.connectRelay(i).catch(c=>(console.warn(`[Nostr Client] Failed to connect to ${i}:`,c.message),null))),s=(await Promise.all(o)).filter(Boolean);if(s.length===0)throw new Error("Failed to connect to any relay");return console.log(`[Nostr Client] Connected to ${s.length}/${this.relays.length} relays`),new Promise((i,c)=>{let a=!1,f=setTimeout(()=>{a||(a=!0,this.closeSubscription(n),c(new Error("Event not found (timeout)")))},1e4);s.forEach(l=>{let u=y=>{try{let p=JSON.parse(y.data);if(p[0]==="EVENT"&&p[1]===n&&!a){a=!0,clearTimeout(f);let d=p[2];console.log("[Nostr Client] Event received:",d),this.closeSubscription(n),i(d)}p[0]==="EOSE"&&p[1]===n&&console.log("[Nostr Client] EOSE received from relay")}catch(p){console.error("[Nostr Client] Failed to parse message:",p)}};l.addEventListener("message",u),this.subscriptions.has(n)||this.subscriptions.set(n,[]),this.subscriptions.get(n).push({ws:l,handler:u});let g=JSON.stringify(["REQ",n,r]);l.send(g),console.log("[Nostr Client] Sent REQ to relay:",g)})})}closeSubscription(e){let n=this.subscriptions.get(e);n&&(n.forEach(({ws:r,handler:o})=>{try{r.send(JSON.stringify(["CLOSE",e])),r.removeEventListener("message",o)}catch{}}),this.subscriptions.delete(e),console.log(`[Nostr Client] Closed subscription ${e}`))}closeAll(){this.subscriptions.forEach((e,n)=>{this.closeSubscription(n)}),this.connections.forEach((e,n)=>{try{e.close()}catch{}}),this.connections.clear(),console.log("[Nostr Client] All connections closed")}};function Ts(t){let e=t.tags.filter(n=>n[0]==="imeta");return e.length>0?Qf(t,e):Ff(t)}function Qf(t,e){let n=e.map(l=>tl(l)).filter(Boolean),r=n.filter(l=>l.mimeType?.startsWith("video/")),o=n.filter(l=>l.mimeType?.startsWith("image/"));e.forEach(l=>{for(let u=1;u<l.length;u++){let g=l[u];if(g.startsWith("image ")){let y=g.substring(6).trim();y&&!o.some(p=>p.url===y)&&o.push({url:y,fallbackUrls:[]})}}}),r.sort((l,u)=>{let g=tn(l);return tn(u)-g});let s=t.tags.find(l=>l[0]==="title")?.[1]||t.tags.find(l=>l[0]==="alt")?.[1]||t.content||"Untitled Video",i=t.content||"",c=parseInt(t.tags.find(l=>l[0]==="duration")?.[1]||"0",10),a=t.tags.find(l=>l[0]==="content-warning")?.[1],f=t.pubkey;return{id:t.id,kind:t.kind,title:s,description:i,author:f,createdAt:t.created_at,duration:c,contentWarning:a,videoVariants:r,thumbnails:o}}function Ff(t){let e=t.tags.find(u=>u[0]==="url")?.[1]||"",n=t.tags.find(u=>u[0]==="m")?.[1]||"video/mp4",r=t.tags.find(u=>u[0]==="thumb")?.[1]||"",o=t.tags.find(u=>u[0]==="title")?.[1]||t.content||"Untitled Video",s=t.tags.find(u=>u[0]==="description")?.[1]||t.content||"",i=parseInt(t.tags.find(u=>u[0]==="duration")?.[1]||"0",10),c=t.tags.find(u=>u[0]==="content-warning")?.[1],a=t.tags.find(u=>u[0]==="dim")?.[1],f=e?[{url:e,mimeType:n,dimensions:a,fallbackUrls:[]}]:[],l=r?[{url:r,fallbackUrls:[]}]:[];return{id:t.id,kind:t.kind,title:o,description:s,author:t.pubkey,createdAt:t.created_at,duration:i,contentWarning:c,videoVariants:f,thumbnails:l}}function tl(t){let e={};for(let n=1;n<t.length;n++){let r=t[n],o=r.indexOf(" ");if(o===-1)continue;let s=r.substring(0,o),i=r.substring(o+1).trim();s==="url"?e.url=i:s==="m"?e.mimeType=i:s==="dim"?e.dimensions=i:s==="size"?e.size=parseInt(i,10):s==="x"?e.hash=i:(s==="fallback"||s==="mirror")&&(e.fallbackUrls||(e.fallbackUrls=[]),e.fallbackUrls.push(i))}return e.url?(e.fallbackUrls||(e.fallbackUrls=[]),e):null}function tn(t){if(t.dimensions){let e=t.dimensions.match(/x(\d+)/);if(e)return parseInt(e[1],10)}return 0}function As(t,e="auto"){if(!t||t.length===0)return null;if(e==="auto")return t[0];let n=parseInt(e,10);if(isNaN(n))return t[0];let r=t[0],o=Math.abs(tn(r)-n);for(let s of t){let i=tn(s),c=Math.abs(i-n);c<o&&(r=s,o=c)}return r}var en=null;async function Ss(){console.log("[Nostube Embed] Initializing player...");try{let t=vr(),e=Er(t);if(!e.valid){ce(e.error);return}el("Loading video...");let n=Es(t.videoId);if(!n){ce("Failed to decode video identifier");return}let r=Bs(n.data.relays,t.customRelays);en=new Fe(r);let o=await en.fetchEvent(n),s=Ts(o);console.log("[Nostube Embed] Parsed video:",s);let i=As(s.videoVariants,t.preferredQuality);if(!i){ce("No video URLs found in event");return}console.log("[Nostube Embed] Selected variant:",i),nl(`Video parsed! Title: "${s.title}"`)}catch(t){console.error("[Nostube Embed] Error:",t),t.message.includes("timeout")?ce("Connection failed. Unable to fetch video."):t.message.includes("not found")?ce("Video not found"):ce(t.message)}}function el(t){document.body.innerHTML=`
    <div style="display: flex; align-items: center; justify-content: center;
                height: 100vh; background: #000; color: #fff;
                font-family: system-ui, -apple-system, sans-serif;
                text-align: center; padding: 20px;">
      <div>
        <div style="font-size: 48px; margin-bottom: 16px; animation: spin 1s linear infinite;">
          \u23F3
        </div>
        <div style="font-size: 14px; color: #999;">${t}</div>
      </div>
    </div>
    <style>
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
  `}function nl(t){document.body.innerHTML=`
    <div style="display: flex; align-items: center; justify-content: center;
                height: 100vh; background: #000; color: #fff;
                font-family: system-ui, -apple-system, sans-serif;
                text-align: center; padding: 20px;">
      <div>
        <div style="font-size: 48px; margin-bottom: 16px;">\u2705</div>
        <div style="font-size: 14px; color: #999;">${t}</div>
      </div>
    </div>
  `}function ce(t){document.body.innerHTML=`
    <div style="display: flex; align-items: center; justify-content: center;
                height: 100vh; background: #000; color: #fff;
                font-family: system-ui, -apple-system, sans-serif;
                text-align: center; padding: 20px;">
      <div>
        <div style="font-size: 48px; margin-bottom: 16px;">\u26A0\uFE0F</div>
        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Error</div>
        <div style="font-size: 14px; color: #999;">${t}</div>
      </div>
    </div>
  `}window.addEventListener("beforeunload",()=>{en&&en.closeAll()});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ss):Ss();})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
